--- a/librz/util/thread_sem.c
+++ b/librz/util/thread_sem.c
@@ -26,6 +26,8 @@ RZ_API RZ_OWN RzThreadSemaphore *rz_th_sem_new(unsigned int initial) {
 	RzThreadSemaphore *sem = RZ_NEW(RzThreadSemaphore);
 	if (!sem) {
 		return NULL;
 	}
+#if defined(__EMSCRIPTEN__)
+	/* Single-threaded: no semaphore init needed, just return the allocated struct */
 #if HAVE_PTHREAD
 #if RZ_SEM_NAMED_ONLY
 	uuid_t uuid;
@@ -56,9 +58,10 @@ RZ_API RZ_OWN RzThreadSemaphore *rz_th_sem_new(unsigned int initial) {
 		return NULL;
 	}
 #endif
-#elif __WINDOWS__
+#elif defined(__WINDOWS__)
 	sem->sem = CreateSemaphore(NULL, (LONG)initial, ST32_MAX, NULL);
 	if (!sem->sem) {
 		free(sem);
 		return NULL;
 	}
+#endif /* __EMSCRIPTEN__ check wraps the whole platform-specific block */
 #endif
 	return sem;
 }
@@ -74,14 +77,18 @@ RZ_API void rz_th_sem_free(RZ_NULLABLE RzThreadSemaphore *sem) {
 	if (!sem) {
 		return;
 	}
+#if defined(__EMSCRIPTEN__)
+	/* Single-threaded: just free */
+#else
 #if HAVE_PTHREAD
 	if (sem->sem) {
 #if RZ_SEM_NAMED_ONLY
 		sem_close(sem->sem);
 #else
 		sem_destroy(sem->sem);
 		free(sem->sem);
 #endif
 	}
-#elif __WINDOWS__
+#elif defined(__WINDOWS__)
 	CloseHandle(sem->sem);
+#endif
 #endif
 	free(sem);
 }
@@ -98,9 +105,13 @@ RZ_API void rz_th_sem_free(RZ_NULLABLE RzThreadSemaphore *sem) {
 RZ_API void rz_th_sem_post(RZ_NONNULL RzThreadSemaphore *sem) {
 	rz_return_if_fail(sem);
+#if defined(__EMSCRIPTEN__)
+	/* Single-threaded: no-op */
+#else
 #if HAVE_PTHREAD
 	sem_post(sem->sem);
-#elif __WINDOWS__
+#elif defined(__WINDOWS__)
 	ReleaseSemaphore(sem->sem, 1, NULL);
+#endif
 #endif
 }
 
@@ -112,9 +123,13 @@ RZ_API void rz_th_sem_post(RZ_NONNULL RzThreadSemaphore *sem) {
 RZ_API void rz_th_sem_wait(RZ_NONNULL RzThreadSemaphore *sem) {
 	rz_return_if_fail(sem);
+#if defined(__EMSCRIPTEN__)
+	/* Single-threaded: no-op, nothing to wait for */
+#else
 #if HAVE_PTHREAD
 	while (sem_wait(sem->sem) < 0 && errno == EINTR)
 		;
-#elif __WINDOWS__
+#elif defined(__WINDOWS__)
 	WaitForSingleObject(sem->sem, INFINITE);
+#endif
 #endif
 }
